from flask import Flask, Response, request
import picamera
import time
import os

# Initialize Flask app
app = Flask(__name__)
camera = picamera.PiCamera()
camera.resolution = (640, 480)
camera.framerate = 24

@app.route('/video_feed')
def video_feed():
    def generate_frames():
        while True:
            camera.capture('frame.jpg', use_video_port=True)
            with open('frame.jpg', 'rb') as f:
                yield (b'--frame\r\n'
                       b'Content-Type: image/jpeg\r\n\r\n' +
                       f.read() + b'\r\n')
    return Response(generate_frames(), mimetype='multipart/x-mixed-replace; boundary=frame')

@app.route('/voice_input', methods=['POST'])
def voice_input():
    audio_file = request.files['audio']
    audio_path = 'user_audio.wav'
    with open(audio_path, 'wb') as f:
        f.write(audio_file.read())
    return "Audio received and saved."

if __name__ == "__main__":
    app.run(host='0.0.0.0', port=5000)
